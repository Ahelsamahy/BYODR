<html>
<head>
    <meta charset="UTF-8">
    <title>Teleop</title>
    <style type="text/css">
        html {
          height: 100%;
          background-image: linear-gradient(to top, white, black);
        }

        body {
          /* background-color: black; */
          /* color: white; */
        }

        .centered {
          position: absolute;
          top: 0;
          left: 50%;
          margin-right: -50%;
          transform: translate(-50%, 0);
        }

        .right {
          float: right;
        }

        .left {
          float: left;
        }

        div#column {
          float: left;
        }

        .message {
          color: #000;
          font-family: Verdana;
          font-size; 13px;
          border: 1px solid #ccc;
          margin-top: 16px;
          margin-bottom: 16px;
          padding: 10px;
        }

        .warning_message {
          background-color: #ffffcc;
        }

        .error_message {
          background-color: #9c2b2e;
        }

        div#bar {
          text-align: center;
          color: white;
          font-family: Verdana;
        }

        div#dashboard {
            margin: 0 0 0 30%;
        }

        img#arrow {
          padding-top: 10px;
        }

        div#alpha_speed {
          display: inline-block;
          font-size: 8px;
          padding: 5px 10px 0 20px;
        }

        div#beta_speed {
          display: inline-block;
          font-size: 8px;
          padding: 10px 10px 0 10px;
        }

        div#alpha_speed_value {
          font-size: 30px;
        }

        div#beta_speed_value {
          font-size: 30px;
        }

        div#beta_speed_label {
          font-size: 8px;
        }

        img#steeringWheel {
          transform: scale(0.8);
          padding: 10px 0 0 0;
        }

        div#debug_values {
          color: white;
          font-family: "Lucida Console";
          font-size: 10px;
          float: right;
          margin: 5px 0 0 50px;
        }
        div#debug_values > p {
          margin-block-start: 0;
          margin-block-end: 0;
          text-align: right;
        }
        div#stream_links {
          padding-top: 20px;
          text-align: left;
        }
        div#stream_links > a {
            font-family: "Lucida Console";
            font-size: 16px;
        }
        div#stream_links > a:link, a:visited {
            text-decoration: none;
        }
        div#stream_links > a:hover {
            color: blue;
        }
        div#stream_links > a.inactive {
            color: white;
        }
        div#stream_links > a:hover, a:active, a.active {
            color: lightblue;
        }
        div#mjpeg_stream_controls {
            padding: 37px 0 0 20px;
            font-family: "Lucida Console";
            font-size: 15px;
        }
        div#mjpeg_stream_controls > img {
            background: white;
            width: 15px;
            height: 15px;
        }
        div#mjpeg_stream_controls > img#caret_up {
            transform: rotate(180deg);
        }
        div#mjpeg_stream_controls > img#caret_down {
            margin-left: 3px;
        }
        span#autopilot_status {
            display: inline-block;
            width: 45px;
        }
        div#home_menu {
        }
        img#home_menu_icon {
            margin: 10px 0 0 0;
            width: 50px;
            height: 50px;
        }
    </style>
    <script src="jquery-3.4.1.min.js"></script>
    <script src="performance-polyfill.js?v=0.20"></script>
	<script src="http-live-player.js?v=0.20"></script>
	<script src="index_utils.js?v=0.20.5c"></script>
	<script src="index_gamepad.js?v=0.20.5e"></script>
	<script src="index_teleop.js?v=0.20.5f"></script>
	<script src="index_mjpeg.js?v=0.20.5c"></script>
	<script src="index_h264.js?v=0.20.5c"></script>
</head>
<body>
<div id="container" class="centered">
    <div id="column">
        <div id="message_box" class="message"></div>
        <div id="bar">
            <div id="home_menu" class="left">
                <a href="/user_options.htm?v=0.20"><img id="home_menu_icon" src='index-menu.png?v=0.20'/></a>
            </div>
            <div id="stream_links" class="left">
                <a id="video_stream_h264" href="#" onclick="page_utils.set_stream_type('h264'); location.reload();">h264</a><br/>
                <a id="video_stream_mjpeg" href="#" onclick="page_utils.set_stream_type('mjpeg'); location.reload();">mjpeg</a>
            </div>
            <div id="mjpeg_stream_controls" class="left">
                <span id="mjpeg_quality_val">0</span>
                <img id="caret_down" src='caret.png?v=0.20' onclick="mjpeg_caret_down();"/>
                <img id="caret_up" src='caret.png?v=0.20' onclick="mjpeg_caret_up();"/>
            </div>
            <div id="dashboard" class="left">
                <span id="autopilot_status"></span>
                <img id="arrow"/>
                <div id="alpha_speed">
                    <div id="alpha_speed_value">0</div>
                    <div id="alpha_speed_label"></div>
                </div>
                <img id="steeringWheel"/>
                <div id="beta_speed">
                    <div id="beta_speed_value">0</div>
                    <div id="beta_speed_label">km/h</div>
                </div>
            </div>
            <div id="debug_values">
                <p class="debug_line"><span id="pilot_steering">0</span>&nbsp;ste</p>
                <p class="debug_line"><span id="pilot_throttle">0</span>&nbsp;thr</p>
                <p class="debug_line"><span id="inference_penalty">0</span>&nbsp;pen</p>
                <p class="debug_line"><span id="inference_obstacle">0</span>&nbsp;obs</p>
                <p class="debug_line"><span id="inference_fps">0</span>&nbsp;fps</p>
            </div>
        </div>
        <div id="camera1"></div>
    </div>
</div>
<script type="text/javascript">
function mjpeg_refresh_page_values() {
    $('span#mjpeg_quality_val').text(mjpeg_controller.max_jpeg_quality);
}

function mjpeg_caret_up() {
    mjpeg_controller.set_max_quality(mjpeg_controller.max_jpeg_quality + 5);
    mjpeg_refresh_page_values();
}

function mjpeg_caret_down() {
    mjpeg_controller.set_max_quality(mjpeg_controller.max_jpeg_quality - 5);
    mjpeg_refresh_page_values();
}
function start_all_handlers() {
    teleop_start_all();
    mjpeg_start_all();
    h264_start_all();
}
function stop_all_handlers() {
    teleop_stop_all();
    mjpeg_stop_all();
    h264_stop_all();
}

// Set the name of the hidden property and the change event for visibility
var hidden, visibilityChange;
if (typeof document.hidden !== "undefined") { // Opera 12.10 and Firefox 18 and later support
  hidden = "hidden";
  visibilityChange = "visibilitychange";
} else if (typeof document.msHidden !== "undefined") {
  hidden = "msHidden";
  visibilityChange = "msvisibilitychange";
} else if (typeof document.webkitHidden !== "undefined") {
  hidden = "webkitHidden";
  visibilityChange = "webkitvisibilitychange";
}

function handleVisibilityChange() {
  if (document[hidden]) {
    stop_all_handlers();
  } else {
    start_all_handlers();
  }
}

$(function () {
    window.history.pushState({}, 'application_index_loaded', '/');
    if (page_utils.get_stream_type() == 'mjpeg') {
        $('a#video_stream_mjpeg').addClass('active');
        $('a#video_stream_h264').addClass('inactive');
        mjpeg_refresh_page_values();
        $('div#mjpeg_stream_controls').show();
    } else {
        $('a#video_stream_mjpeg').addClass('inactive');
        $('a#video_stream_h264').addClass('active');
        $('div#mjpeg_stream_controls').hide();
    }
    document.addEventListener(visibilityChange, handleVisibilityChange, false);
    window.addEventListener('focus', start_all_handlers);
    window.addEventListener('blur', stop_all_handlers);
    start_all_handlers();
});
</script>
</body>
</html>